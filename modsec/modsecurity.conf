# ==============================
# ModSecurity v3 Configuration
# ==============================

# Enable ModSecurity engine
SecRuleEngine On

# Audit logging
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^4[0-9]{2}$|^5[0-9]{2}$"
SecAuditLog /var/log/modsec_audit.log
SecAuditLogFormat JSON
## added from chatgpt
SecAuditLogType Serial
SecAuditLogParts ABIJDEFHZ

# Debug log (optional – enable if troubleshooting)
SecDebugLog /var/log/modsec_debug.log
SecDebugLogLevel 9

# Request body handling
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyLimitAction Reject

# Response body handling
SecResponseBodyAccess Off

# Content-Type handlers
SecRule REQUEST_HEADERS:Content-Type "text/xml" \
     "id:200000,phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML"

SecRule REQUEST_HEADERS:Content-Type "application/json" \
     "id:200001,phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON"

# ==============================
# Load Core Rule Set (CRS)
# ==============================

# CRS setup
Include /etc/nginx/modsec/crs/crs-setup.conf

# CRS rules
Include /etc/nginx/modsec/crs/rules/*.conf

# Disabled rules (optional – must come last)
Include /etc/nginx/modsec/disabled_rules.conf
